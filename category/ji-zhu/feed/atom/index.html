<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom"><title>Linux迷+Python粉 - 技术</title><link href="https://blog.pythonwood.com/" rel="alternate"></link><link href="https://blog.pythonwood.com/category/ji-zhu/feed/atom/index.html" rel="self"></link><id>https://blog.pythonwood.com/</id><updated>2017-12-01T00:00:00+08:00</updated><entry><title>第二次开源贡献，为pelican的plumage主题修改被owner接受</title><link href="https://blog.pythonwood.com/2017/12/%E7%AC%AC%E4%BA%8C%E6%AC%A1%E5%BC%80%E6%BA%90%E8%B4%A1%E7%8C%AE%EF%BC%8C%E4%B8%BApelican%E7%9A%84plumage%E4%B8%BB%E9%A2%98%E4%BF%AE%E6%94%B9%E8%A2%ABowner%E6%8E%A5%E5%8F%97/" rel="alternate"></link><published>2017-12-01T00:00:00+08:00</published><updated>2017-12-01T00:00:00+08:00</updated><author><name>pythonwood</name></author><id>tag:blog.pythonwood.com,2017-12-01:/2017/12/第二次开源贡献，为pelican的plumage主题修改被owner接受/</id><summary type="html">&lt;p&gt;2017年11月，正在折腾静态博客。最后使用了pelican生产+plumage主题并自行汉化。其中发现些许问题。&lt;/p&gt;
&lt;p&gt;29号时，对plumage主题进行完善，并提交了一个修复不支持PAGINATION_PATTERNS参数问题的fixbug型&lt;a href="https://github.com/kdeldycke/plumage/pull/21/commits/cc887089a365420ec1ed00cc0bcedc3573ab6e8c"&gt;pull request&lt;/a&gt;。&lt;/p&gt;
&lt;p&gt;30号时，原作者&lt;a href="https://kevin.deldycke.com/"&gt;Kevin Deldycke&lt;/a&gt;接受合并到了master。&lt;/p&gt;
&lt;h4 id="pelicanplumgeowner"&gt;纪念一下，这是第二次开源贡献，为pelican的plumge主题修改被owner接受。&lt;a class="headerlink" href="#pelicanplumgeowner" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h4&gt;
&lt;p&gt;&lt;img alt="第二次开源贡献，为pelican的plumge主题修改被owner接受" src="https://blog.pythonwood.com/uploads/2017/第二次开源贡献，为pelican的plumge主题修改被owner接受.png" title="第二次开源贡献，为pelican的plumge主题修改被owner接受"&gt;&lt;/p&gt;
&lt;h4 id="201647twisted-intro-cn"&gt;第一次是2016年4月7日对开源书籍的&lt;a href="https://github.com/likebeta/twisted-intro-cn"&gt;twisted-intro-cn …&lt;/a&gt;&lt;/h4&gt;</summary><content type="html">&lt;p&gt;2017年11月，正在折腾静态博客。最后使用了pelican生产+plumage主题并自行汉化。其中发现些许问题。&lt;/p&gt;
&lt;p&gt;29号时，对plumage主题进行完善，并提交了一个修复不支持PAGINATION_PATTERNS参数问题的fixbug型&lt;a href="https://github.com/kdeldycke/plumage/pull/21/commits/cc887089a365420ec1ed00cc0bcedc3573ab6e8c"&gt;pull request&lt;/a&gt;。&lt;/p&gt;
&lt;p&gt;30号时，原作者&lt;a href="https://kevin.deldycke.com/"&gt;Kevin Deldycke&lt;/a&gt;接受合并到了master。&lt;/p&gt;
&lt;h4 id="pelicanplumgeowner"&gt;纪念一下，这是第二次开源贡献，为pelican的plumge主题修改被owner接受。&lt;a class="headerlink" href="#pelicanplumgeowner" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h4&gt;
&lt;p&gt;&lt;img alt="第二次开源贡献，为pelican的plumge主题修改被owner接受" src="https://blog.pythonwood.com/uploads/2017/第二次开源贡献，为pelican的plumge主题修改被owner接受.png" title="第二次开源贡献，为pelican的plumge主题修改被owner接受"&gt;&lt;/p&gt;
&lt;h4 id="201647twisted-intro-cn"&gt;第一次是2016年4月7日对开源书籍的&lt;a href="https://github.com/likebeta/twisted-intro-cn"&gt;twisted-intro-cn&lt;/a&gt;的贡献&lt;a href="https://github.com/likebeta/twisted-intro-cn/commit/93f959edf227769cab4f812038f01bef5cdb8ac1"&gt;修改鸭子模式介绍&lt;/a&gt;&lt;a class="headerlink" href="#201647twisted-intro-cn" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h4&gt;
&lt;p&gt;&lt;img alt="第一次开源贡献，修改鸭子模式介绍" src="https://blog.pythonwood.com/uploads/2017/第一次开源贡献，修改鸭子模式介绍.png" title="第一次开源贡献，修改鸭子模式介绍"&gt;&lt;/p&gt;</content><category term="pelican"></category><category term="plumage"></category><category term="贡献"></category><category term="pull"></category><category term="request"></category><category term="first"></category><category term="github"></category></entry><entry><title>树莓派SD卡Linux系统盘复制，10分钟克隆新机</title><link href="https://blog.pythonwood.com/2017/11/%E6%A0%91%E8%8E%93%E6%B4%BESD%E5%8D%A1Linux%E7%B3%BB%E7%BB%9F%E7%9B%98%E5%A4%8D%E5%88%B6%EF%BC%8C10%E5%88%86%E9%92%9F%E5%85%8B%E9%9A%86%E6%96%B0%E6%9C%BA/" rel="alternate"></link><published>2017-11-30T15:02:00+08:00</published><updated>2017-11-30T15:12:00+08:00</updated><author><name>pythonwood</name></author><id>tag:blog.pythonwood.com,2017-11-30:/2017/11/树莓派SD卡Linux系统盘复制，10分钟克隆新机/</id><summary type="html">&lt;p&gt;在家里，用了一周时间，将新买的树莓派3，&lt;a href="https://s.click.taobao.com/t?e=m%3D2%26s%3DyO9jlKzcxlwcQipKwQzePOeEDrYVVa64K7Vc7tFgwiHjf2vlNIV67jeJ0D4P3i%2B8UOZr0mLjuses9V29auOuBOBgn3DwXo5fs9cRaxJdiKw3LnkA3bZiA%2F6gPESVKznnDfaTZ11r%2FGF6awgoXsc5TKo%2FiSVAKeldcSpj5qSCmbA%3D&amp;amp;pvid=10_120.239.178.6_72377_1512026724825" title="华趸hdmi转vga线带音频带供电"&gt;HDMI转VGA带供电&lt;/a&gt;(性价比推荐)，旧显示屏，旧音箱。组成家庭媒体中心。手机使用bubbleupnp投屏和推送音乐播放，听音乐的享受更舒服了，显示屏再大些就更好。&lt;/p&gt;
&lt;p&gt;&lt;img alt="房间树莓派媒体中心" src="https://blog.pythonwood.com/uploads/2017/房间树莓派媒体中心.jpg" title="房间树莓派媒体中心"&gt;&lt;/p&gt;
&lt;p&gt;在工作室，还有一个树莓派和支持HDMI输出的投影仪。如果能复制现有树莓派的系统SD卡，将省事不少。（重复的事应少做）&lt;/p&gt;
&lt;h3 id="_1"&gt;开始折腾尝试&lt;a class="headerlink" href="#_1" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;借助我的个人电脑是ubutnu，可以看见树莓派分区情况，第二个分区14G采用了3G …&lt;/p&gt;</summary><content type="html">&lt;p&gt;在家里，用了一周时间，将新买的树莓派3，&lt;a href="https://s.click.taobao.com/t?e=m%3D2%26s%3DyO9jlKzcxlwcQipKwQzePOeEDrYVVa64K7Vc7tFgwiHjf2vlNIV67jeJ0D4P3i%2B8UOZr0mLjuses9V29auOuBOBgn3DwXo5fs9cRaxJdiKw3LnkA3bZiA%2F6gPESVKznnDfaTZ11r%2FGF6awgoXsc5TKo%2FiSVAKeldcSpj5qSCmbA%3D&amp;amp;pvid=10_120.239.178.6_72377_1512026724825" title="华趸hdmi转vga线带音频带供电"&gt;HDMI转VGA带供电&lt;/a&gt;(性价比推荐)，旧显示屏，旧音箱。组成家庭媒体中心。手机使用bubbleupnp投屏和推送音乐播放，听音乐的享受更舒服了，显示屏再大些就更好。&lt;/p&gt;
&lt;p&gt;&lt;img alt="房间树莓派媒体中心" src="https://blog.pythonwood.com/uploads/2017/房间树莓派媒体中心.jpg" title="房间树莓派媒体中心"&gt;&lt;/p&gt;
&lt;p&gt;在工作室，还有一个树莓派和支持HDMI输出的投影仪。如果能复制现有树莓派的系统SD卡，将省事不少。（重复的事应少做）&lt;/p&gt;
&lt;h3 id="_1"&gt;开始折腾尝试&lt;a class="headerlink" href="#_1" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;借助我的个人电脑是ubutnu，可以看见树莓派分区情况，第二个分区14G采用了3G，很多空间是多余的。&lt;/p&gt;
&lt;p&gt;&lt;img alt="gparted看树莓派分区" src="https://blog.pythonwood.com/uploads/2017/gparted看树莓派分区.jpg" title="gparted看树莓派分区"&gt;&lt;/p&gt;
&lt;p&gt;用了1天的不断努力尝试终于才成功，囧。&lt;/p&gt;
&lt;h3 id="1ddddrescue"&gt;失败1:使用DD或ddrescue&lt;a class="headerlink" href="#1ddddrescue" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;不幸的是我是从14.6G卡克隆到14.4G卡，使用dd失败是注定的。使用dd的必要条件是目标卡要更大。&lt;/p&gt;
&lt;h3 id="2linuxssdetc"&gt;失败2:源自笔记本linux系统迁移SSD的经验——分区一样，复制文件，改etc配置法。&lt;a class="headerlink" href="#2linuxssdetc" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;linux磁盘迁移，只需分区格式化，复制文件，修改etc下的fstab和udev目录的网卡信息，chroot+grub安装。就能完成。&lt;/p&gt;
&lt;p&gt;然而实践得知，不适用树莓派迁移。启动时卡在&amp;rdquo;smsc95xx 1-1.1:1.0: eth0: register &amp;lsquo;smsc95xx&amp;rsquo;&amp;nbsp;&amp;hellip;&amp;rdquo;之后。无法启动。&lt;/p&gt;
&lt;p&gt;比较发现，复制时，不会有dev/by-partuuid/目录，而本身树莓派是有这个目录的。&lt;/p&gt;
&lt;h3 id="ddrawresize2fsqemu-imgdiskdd"&gt;成功:dd读取为raw镜像盘、resize2fs缩容分区、qemu-img缩容disk、dd写入成功启动树莓派&lt;a class="headerlink" href="#ddrawresize2fsqemu-imgdiskdd" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h3&gt;
&lt;h4 id="ddrawsd"&gt;先dd读取物理盘为raw格式镜像盘。这样就可以方法搞，最坏情况也不影响已有的系统sd卡内容。&lt;a class="headerlink" href="#ddrawsd" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h4&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;$sudo dd if=/dev/sdb of=/home/16G.img bs=128K
&lt;/pre&gt;&lt;/div&gt;


&lt;h4 id="loopgparted"&gt;挂载loop设备以便于gparted能操作&lt;a class="headerlink" href="#loopgparted" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h4&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;$sudo losetup /dev/loop0 /home/16G.img
$sudo partprobe /dev/loop0  # 运行后才会出现分区/dev/loop0p1,/dev/loop0p2
&lt;/pre&gt;&lt;/div&gt;


&lt;h4 id="14g6gblock6g"&gt;第二分区从14G缩容到6G（实际是把分散的Block数据集中到前6G位置。非真正改变分区大小）&lt;a class="headerlink" href="#14g6gblock6g" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h4&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;$sudo e2fsck -f /dev/loop0p2
$sudo resize2fs /dev/loop0p2 6G
&lt;/pre&gt;&lt;/div&gt;


&lt;h4 id="gparted-fdisk-6g"&gt;GParted / Fdisk 更改第二分区为6G&lt;a class="headerlink" href="#gparted-fdisk-6g" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h4&gt;
&lt;p&gt;GParted&amp;nbsp;/dev/loop0打开，然后选择第二分区右击，选择&amp;rdquo;更改/移动大小&amp;rdquo;。设置。&lt;/p&gt;
&lt;h4 id="loop"&gt;卸载恢复loop设备:&lt;a class="headerlink" href="#loop" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h4&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;$sudo partprobe -d /dev/loop0
$sudo losetup -d /dev/loop0
&lt;/pre&gt;&lt;/div&gt;


&lt;h4 id="raw"&gt;raw虚拟磁盘缩容&lt;a class="headerlink" href="#raw" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h4&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;$sudo qemu-img resize /home/16G.img -8G

$qemu-img info /home/16G.img
image: xxx.img
file format: raw
virtual size: 5.9G (6380060672 bytes)
disk size: 5.9G
&lt;/pre&gt;&lt;/div&gt;


&lt;h4 id="ddsd"&gt;使用DD写入新SD卡，启动成功。&lt;a class="headerlink" href="#ddsd" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h4&gt;
&lt;p&gt;可选：写入sd后可以用e2resize扩容分区完全用上SD卡空间，参考上面缩容。&lt;/p&gt;
&lt;h3 id="_2"&gt;参考&lt;a class="headerlink" href="#_2" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;把一块硬盘上的 Linux 系统整个复制到新硬盘上的方法.  &lt;a href="https://www.v2ex.com/t/183310"&gt;https://www.v2ex.com/t/183310&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;openstack文档 &lt;a href="http://docs.ocselected.org/openstack-manuals/kilo/image-guide/content/ch_modifying_images.html#losetup-kpartx-nbd"&gt;http://docs.ocselected.org/openstack-manuals/kilo/image-guide/content/ch_modifying_images.html#losetup-kpartx-nbd&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;使用qemu-img改变镜像文件大小  &lt;a href="http://niusmallnan.com/_build/html/_templates/knowladge/resize_raw_file.html"&gt;http://niusmallnan.com/_build/html/_templates/knowladge/resize_raw_file.html&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;笔记本硬盘更换记（使用LVM进行在线数据迁移） &lt;a href="http://cathay4t.blogspot.hk/2009/05/lvm.html"&gt;http://cathay4t.blogspot.hk/2009/05/lvm.html&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;新电脑+旧系统：教你在不同机器间转移Linux  &lt;a href="http://www.geekfan.net/1860/"&gt;http://www.geekfan.net/1860/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;usb-creator-gtk 方法和&amp;nbsp;clonezilla方法没有深入研究。&lt;/p&gt;</content><category term="树莓派"></category><category term="rpi"></category><category term="raspbain"></category><category term="raspberry"></category><category term="pi"></category><category term="clone"></category><category term="linux"></category><category term="克隆"></category><category term="系统"></category><category term="uuid"></category><category term="resizefs"></category><category term="qemu-img"></category><category term="losetup"></category><category term="dd"></category><category term="智能家庭"></category></entry><entry><title>ssh命令：隧道代理+本地端口转发+远程端口转发</title><link href="https://blog.pythonwood.com/2016/02/ssh%E5%91%BD%E4%BB%A4%EF%BC%9A%E9%9A%A7%E9%81%93%E4%BB%A3%E7%90%86+%E6%9C%AC%E5%9C%B0%E7%AB%AF%E5%8F%A3%E8%BD%AC%E5%8F%91+%E8%BF%9C%E7%A8%8B%E7%AB%AF%E5%8F%A3%E8%BD%AC%E5%8F%91/" rel="alternate"></link><published>2016-02-15T11:29:00+08:00</published><updated>2017-11-27T22:12:00+08:00</updated><author><name>pythonwood</name></author><id>tag:blog.pythonwood.com,2016-02-15:/2016/02/ssh命令：隧道代理+本地端口转发+远程端口转发/</id><summary type="html">&lt;h3 id="0"&gt;0、前言&lt;a class="headerlink" href="#0" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;nc是一个在网络连接两端的好工具，同时也是也个临时的端口转发的好工具。（永久的端口转发用什么？用iptables）&lt;/p&gt;
&lt;p&gt;ssh也是这方面的好工具，好处是加密可靠可复用在一端操作即可，代价是要有登录帐号。&lt;/p&gt;
&lt;p&gt;我们知道，&lt;span class="caps"&gt;SSH&lt;/span&gt; 会自动加密和解密所有 &lt;span class="caps"&gt;SSH&lt;/span&gt; 客户端与服务端之间的网络数据。但是，&lt;span class="caps"&gt;SSH&lt;/span&gt; 还同时提供了一个非常有用的功能，这就是端口转发。它能够将其他 &lt;span class="caps"&gt;TCP …&lt;/span&gt;&lt;/p&gt;</summary><content type="html">&lt;h3 id="0"&gt;0、前言&lt;a class="headerlink" href="#0" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;nc是一个在网络连接两端的好工具，同时也是也个临时的端口转发的好工具。（永久的端口转发用什么？用iptables）&lt;/p&gt;
&lt;p&gt;ssh也是这方面的好工具，好处是加密可靠可复用在一端操作即可，代价是要有登录帐号。&lt;/p&gt;
&lt;p&gt;我们知道，&lt;span class="caps"&gt;SSH&lt;/span&gt; 会自动加密和解密所有 &lt;span class="caps"&gt;SSH&lt;/span&gt; 客户端与服务端之间的网络数据。但是，&lt;span class="caps"&gt;SSH&lt;/span&gt; 还同时提供了一个非常有用的功能，这就是端口转发。它能够将其他 &lt;span class="caps"&gt;TCP&lt;/span&gt; 端口的网络数据通过 &lt;span class="caps"&gt;SSH&lt;/span&gt;&amp;nbsp;链接来转发，并且自动提供了相应的加密及解密服务。&lt;/p&gt;
&lt;h3 id="1"&gt;1、隧道带理&lt;a class="headerlink" href="#1" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;典型应用：翻越高墙&lt;/p&gt;
&lt;p&gt;需要条件：一个国外vps，一个不需要登录（安全）的帐号，一个命令。&lt;/p&gt;
&lt;p&gt;vps新建帐号：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;useradd -g nobody -s /sbin/nologin  gfw &amp;amp;&amp;amp; echo gfw_Passw0rd | passwd --stdin gfw
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;本地ssh连接：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;ssh -NfD 6666 gfw@vps -p 2222
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;可选转换：使用privoxy把socks5代理变成http代理供svn，pip，gem，curl等工具使用。&lt;/p&gt;
&lt;h3 id="2"&gt;2、本地端口转发&lt;a class="headerlink" href="#2" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;&lt;img alt="tu2" src="https://blog.pythonwood.com/uploads/2016/本地端口转发.jpg" title="2"&gt;&lt;/p&gt;
&lt;p&gt;我们可以将远程机器（LdapClientHost）上的应用直接配置到本机的 7001 端口上（而不是 &lt;span class="caps"&gt;LDAP&lt;/span&gt; 服务器的 389 端口上）。在 LdapClientHost 上执行如下命令即可建立一个 &lt;span class="caps"&gt;SSH&lt;/span&gt;&amp;nbsp;的本地端口转发，例如：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;ssh -L 7001:localhost:389 LdapServerHost
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;之后的数据流将会是下面这个样子：&lt;/p&gt;
&lt;p&gt;我们在 LdapClientHost 上的应用将数据发送到本机的 7001 端口上，
而本机的 &lt;span class="caps"&gt;SSH&lt;/span&gt; Client 会将 7001 端口收到的数据加密并转发到 LdapServertHost 的 &lt;span class="caps"&gt;SSH&lt;/span&gt; Server 上。
&lt;span class="caps"&gt;SSH&lt;/span&gt; Server 会解密收到的数据并将之转发到监听的 &lt;span class="caps"&gt;LDAP&lt;/span&gt; 389 端口上，
最后再将从 &lt;span class="caps"&gt;LDAP&lt;/span&gt;&amp;nbsp;返回的数据原路返回以完成整个流程。&lt;/p&gt;
&lt;h3 id="3"&gt;3、远程端口转发&lt;a class="headerlink" href="#3" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;&lt;img alt="tu3" src="https://blog.pythonwood.com/uploads/2016/远程端口转发.jpg" title="3"&gt;&lt;/p&gt;
&lt;p&gt;我们在 LdapClientHost 上的应用将数据发送到本机的 7001 端口上，而本机的 &lt;span class="caps"&gt;SSH&lt;/span&gt; Server 会将 7001 端口收到的数据加密并转发到 LdapServertHost 的 &lt;span class="caps"&gt;SSH&lt;/span&gt; Client&amp;nbsp;上。&lt;/p&gt;
&lt;p&gt;在 &lt;span class="caps"&gt;LDAP&lt;/span&gt;&amp;nbsp;服务器（LdapServertHost）端执行如下命令：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;ssh -R 7001:localhost:389 LdapClientHost
&lt;/pre&gt;&lt;/div&gt;


&lt;h4 id="_1"&gt;区别：&lt;a class="headerlink" href="#_1" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h4&gt;
&lt;p&gt;&lt;span class="caps"&gt;SSH&lt;/span&gt; 端口转发自然需要 &lt;span class="caps"&gt;SSH&lt;/span&gt; 连接，而 &lt;span class="caps"&gt;SSH&lt;/span&gt; 连接是有方向的，从 &lt;span class="caps"&gt;SSH&lt;/span&gt; Client 到 &lt;span class="caps"&gt;SSH&lt;/span&gt; Server 。而我们的应用也是有方向的，比如需要连接 &lt;span class="caps"&gt;LDAP&lt;/span&gt; Server 时，&lt;span class="caps"&gt;LDAP&lt;/span&gt; Server 自然就是 Server 端，我们应用连接的方向也是从应用的 Client 端连接到应用的 Server&amp;nbsp;端。如果这两个连接的方向一致，那我们就说它是本地转发。而如果两个方向不一致，我们就说它是远程转发。&lt;/p&gt;
&lt;h3 id="4autosshsupervisior"&gt;4、使用autossh防网络抖动+supervisior进程守护。&lt;a class="headerlink" href="#4autosshsupervisior" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;autossh解决的问题：远程端口转发一旦端口，很难再次建立。&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;autossh -M 1932 -NR  1922:localhost:1122 user@vps -p 1122
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;ps可以看到实质是这样的：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;ssh -L 1932:127.0.0.1:1932 -R 1932:127.0.0.1:1933 -NR 1922:localhost:1122 -p 1122 user@vps
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;分析：使用回路，将本地1933端口，（远程转发）映射到远端1932，（本地转发）到本机的1932。形成回路。&lt;/p&gt;
&lt;p&gt;supervisior解决的问题：autossh的进程守护&lt;/p&gt;
&lt;p&gt;因此，使用supervisior守护autossh，autossh守护ssh。达到自动启动和守护端口转发的目的。&lt;/p&gt;
&lt;h3 id="5"&gt;5、综合使用&lt;a class="headerlink" href="#5" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;案例一、如何2222端口被封，如果绕过封死2222端口的防火墙直接ssh到内网机器。（就是说限某几个端口是有局限的）&lt;/p&gt;
&lt;p&gt;1、登录最重要的机器把2222端口映射到12222端口：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;ssh -gfNL 12222:0.0.0.0:2222 localhost -p2222
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;2、使用该机器做隧道代理访问其他内网机器：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;ssh -NfD 10000 user@host -p12222
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;3、ssh绕道访问其他内网机器：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;ssh -o &amp;quot;ProxyCommand=nc -x localhost:10000 %h %p&amp;quot; user@host -p2222
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;巧妙结合的ssh和nc，都是linux自带工具，没有依赖。&lt;/p&gt;
&lt;p&gt;案例二、借助远程vps让两台不能直接相通的机器相互能访问。&lt;/p&gt;
&lt;p&gt;有主机vps和主机A、B。A、B无法直连，通过“中介”搭桥相连。（两台机器都能主动ssh到vps就能完成。）&lt;/p&gt;
&lt;p&gt;A要ssh到B（B要ssh到A是同理）：&lt;/p&gt;
&lt;p&gt;1、主机B用ssh远程转发自己的2222端口到vps的127.0.0.1:12222&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;ssh -NfR 12222:127.0.0.1:2222 user@vps -p2222
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;2、主机A用ssh本地转发vps的127.0.0.1:12222到本地的127.0.0.1:12222&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;ssh -NfL 12222:127.0.0.1:12222 user@vps -p2222
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;3、主机A登录主机B&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;ssh user@localhost -p12222
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;参考：&lt;/p&gt;
&lt;p&gt;实战 &lt;span class="caps"&gt;SSH&lt;/span&gt;&amp;nbsp;端口转发&lt;/p&gt;
&lt;p&gt;&lt;a href="https://www.ibm.com/developerworks/cn/linux/l-cn-sshforward/"&gt;https://www.ibm.com/developerworks/cn/linux/l-cn-sshforward/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;使用supervisor托管shadowsocks&lt;/p&gt;
&lt;p&gt;&lt;a href="https://blog.phpgao.com/supervisor_shadowsocks.html"&gt;https://blog.phpgao.com/supervisor_shadowsocks.html&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;SSH反向连接及Autossh&lt;/p&gt;
&lt;p&gt;&lt;a href="http://www.cnblogs.com/eshizhan/archive/2012/07/16/2592902.html"&gt;http://www.cnblogs.com/eshizhan/archive/2012/07/16/2592902.html&lt;/a&gt;&lt;/p&gt;</content><category term="ssh"></category><category term="代理"></category><category term="加密隧道"></category><category term="转发"></category><category term="privoxy"></category><category term="autossh"></category><category term="远程访问"></category></entry><entry><title>不能小看的nc——实践TCP协议第四层的软件（传输层）</title><link href="https://blog.pythonwood.com/2015/12/%E4%B8%8D%E8%83%BD%E5%B0%8F%E7%9C%8B%E7%9A%84nc%E2%80%94%E2%80%94%E5%AE%9E%E8%B7%B5TCP%E5%8D%8F%E8%AE%AE%E7%AC%AC%E5%9B%9B%E5%B1%82%E7%9A%84%E8%BD%AF%E4%BB%B6%EF%BC%88%E4%BC%A0%E8%BE%93%E5%B1%82%EF%BC%89/" rel="alternate"></link><published>2015-12-20T21:20:00+08:00</published><updated>2017-11-30T22:12:00+08:00</updated><author><name>pythonwood</name></author><id>tag:blog.pythonwood.com,2015-12-20:/2015/12/不能小看的nc——实践TCP协议第四层的软件（传输层）/</id><summary type="html">&lt;p&gt;nc命令全名为netcat，顾名思义就是通过TCP或UDP从网络读写数据。&lt;/p&gt;
&lt;p&gt;很多事情不一定非得抓包，nc也能发挥巨大作用。&lt;/p&gt;
&lt;h3 id="1"&gt;1、传输文件&lt;a class="headerlink" href="#1" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h3&gt;
&lt;h4 id="_1"&gt;使用&amp;lt;&amp;gt;重定向符（只适用单文件，不推荐、失败时 &amp;ldquo;&amp;gt;&amp;rdquo; 产生空文件）&lt;a class="headerlink" href="#_1" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h4&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;nc -l 8888 &amp;lt; demo.txt        # 在本机8888端口侦听TCP连接，将收到的数据写入文件

nc …&lt;/pre&gt;&lt;/div&gt;</summary><content type="html">&lt;p&gt;nc命令全名为netcat，顾名思义就是通过TCP或UDP从网络读写数据。&lt;/p&gt;
&lt;p&gt;很多事情不一定非得抓包，nc也能发挥巨大作用。&lt;/p&gt;
&lt;h3 id="1"&gt;1、传输文件&lt;a class="headerlink" href="#1" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h3&gt;
&lt;h4 id="_1"&gt;使用&amp;lt;&amp;gt;重定向符（只适用单文件，不推荐、失败时 &amp;ldquo;&amp;gt;&amp;rdquo; 产生空文件）&lt;a class="headerlink" href="#_1" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h4&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;nc -l 8888 &amp;lt; demo.txt        # 在本机8888端口侦听TCP连接，将收到的数据写入文件

nc ip 8888 &amp;gt; demo.txt       # 文件接收端：将文件内容通过网络&amp;quot;cat&amp;quot;到远端
&lt;/pre&gt;&lt;/div&gt;


&lt;h4 id="tar"&gt;使用tar传输文件（推荐，好处是保留了原目录结构和权限）&lt;a class="headerlink" href="#tar" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h4&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;tar cz demo1.txt demo_dir/ | nc -l 8888  # 监听8888端口，有连接时开始tar打包并&amp;quot;cat&amp;quot;到远端

nc ip 8888 | tar zx                                 # 连接、接收数据、解压一步到位。
&lt;/pre&gt;&lt;/div&gt;


&lt;h3 id="2"&gt;2、建立网络管道&lt;a class="headerlink" href="#2" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h3&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;nc -l 8888                            # 接收消息

echo msg | nc ip 8888           # 发送消息
&lt;/pre&gt;&lt;/div&gt;


&lt;h3 id="3"&gt;3、迁移生产机房数据到测试机房（运维电脑建管道）&lt;a class="headerlink" href="#3" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h3&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;tar cz demo1.txt demo_dir/ | nc -l 8888  # 生产机房ipA

nc -l 8888 | tar zx                                 # 测试机房ipB

nc ipA 8888 | nc ipB 8888                      # 运维个人电脑，连通两台机器的8888端口。
&lt;/pre&gt;&lt;/div&gt;


&lt;h3 id="4-lbgudp"&gt;4、测试网络连通 （排查测试机房的lbg转发udp问题）&lt;a class="headerlink" href="#4-lbgudp" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h3&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;curl 调试http，即7层非常高效。但如何调试4层网络呢？答案就是nc
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;测试机房lbg做了公网udp服务的映射，但测试同学发现程序出错，怀疑网络问题，找运维同学排查。&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;nc -ul 9999                   # 服务ipS 监听9999端口 该端口映射到公网 ipVS:portVS

nc -zuv ipS 9999           # 内网udp连通成功   显示Connection to ipS 9999 port [udp/*] succeeded!

nc -zuv ipVS portVS       # 公网udp连通失败   显示Connection to ipVS portVS port [udp/*] fail!

一、上如何检查tcp？以上的参数u去掉，默认就是tcp。

二、进一步写出nagios插件，检查udp服务端口（以部署在PP的udp消息推送监控中）
&lt;/pre&gt;&lt;/div&gt;


&lt;h3 id="5telnetmc"&gt;5、代替telnet，测试mc，浮云等等。&lt;a class="headerlink" href="#5telnetmc" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h3&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;echo -e &amp;quot;stats\r\n&amp;quot; | nc ipS portMC        # 非交换式查看mc的状态。

echo -e &amp;quot;INFO\r\n&amp;quot; | nc ipS portREDIS   # 非交换式查看redis的状态。
&lt;/pre&gt;&lt;/div&gt;


&lt;!--非交换的set、get检查浮云ds        # 已部署到PP的浮云监控。--&gt;

&lt;h3 id="6nchttpshellman-nc"&gt;6、使用nc发邮件，发送http请求，反弹shell，端口转发等等，请man nc&lt;a class="headerlink" href="#6nchttpshellman-nc" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h3&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;echo -e &amp;quot;GET / HTTP/1.0\r\n&amp;quot; | nc uc.cn 80
&lt;/pre&gt;&lt;/div&gt;</content><category term="nc"></category><category term="tcp"></category><category term="第四蹭"></category><category term="传输层"></category><category term="介绍"></category><category term="netcat"></category><category term="网络"></category></entry><entry><title>【实习记】2014-09-26linux下恢复ntfs分区误删的文件</title><link href="https://blog.pythonwood.com/2014/09/%E3%80%90%E5%AE%9E%E4%B9%A0%E8%AE%B0%E3%80%912014-09-26linux%E4%B8%8B%E6%81%A2%E5%A4%8Dntfs%E5%88%86%E5%8C%BA%E8%AF%AF%E5%88%A0%E7%9A%84%E6%96%87%E4%BB%B6/" rel="alternate"></link><published>2014-09-26T15:07:00+08:00</published><updated>2017-11-30T22:12:00+08:00</updated><author><name>pythonwood</name></author><id>tag:blog.pythonwood.com,2014-09-26:/2014/09/【实习记】2014-09-26linux下恢复ntfs分区误删的文件/</id><summary type="html">&lt;h3 id="_1"&gt;忧伤的背景&lt;a class="headerlink" href="#_1" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;情景，ubuntu下把NTFS格式的盘中的“实习记”文件夹彻底删除了，追毁莫及，粗心觉不是一件好的事情。&lt;/p&gt;
&lt;p&gt;linux下回复ntfs盘下的文件不能用ext3grep，而使用debugfs命令实在很原始。&lt;/p&gt;
&lt;p&gt;万幸所有记录文件的文件名都是：【实习记】2014-0&lt;em&gt;*&lt;/em&gt;*.txt&lt;/p&gt;
&lt;p&gt;最后使用ntfsundelete + chown + chmod + sed&amp;nbsp;完美恢复刚才删除是所以TXT文件。&lt;/p&gt;
&lt;h4 id="0"&gt;0、&lt;a class="headerlink" href="#0" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h4&gt;
&lt;p&gt;sudo …&lt;/p&gt;</summary><content type="html">&lt;h3 id="_1"&gt;忧伤的背景&lt;a class="headerlink" href="#_1" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;情景，ubuntu下把NTFS格式的盘中的“实习记”文件夹彻底删除了，追毁莫及，粗心觉不是一件好的事情。&lt;/p&gt;
&lt;p&gt;linux下回复ntfs盘下的文件不能用ext3grep，而使用debugfs命令实在很原始。&lt;/p&gt;
&lt;p&gt;万幸所有记录文件的文件名都是：【实习记】2014-0&lt;em&gt;*&lt;/em&gt;*.txt&lt;/p&gt;
&lt;p&gt;最后使用ntfsundelete + chown + chmod + sed&amp;nbsp;完美恢复刚才删除是所以TXT文件。&lt;/p&gt;
&lt;h4 id="0"&gt;0、&lt;a class="headerlink" href="#0" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h4&gt;
&lt;p&gt;sudo umount&amp;nbsp;该ntfs盘&lt;/p&gt;
&lt;h4 id="1"&gt;1、&lt;a class="headerlink" href="#1" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h4&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;sudo apt-get install ntfs-3g
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;直接安装ntfsundelete是不行的，它被包含于ntfs-3g中，也包含于ntfsprogs(源中已弃用此包)&lt;/p&gt;
&lt;h4 id="2"&gt;2、&lt;a class="headerlink" href="#2" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h4&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;sudo ntfsundelete /dev/sda3 -f -t 3m | grep 实习记 | awk &amp;#39;{print $1}&amp;#39; &amp;gt; ntfsundelete.txt
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;获取所有要恢复的文件的inode值，然后使用vi编辑使inode组成&amp;rdquo;881,2341,234,&amp;hellip;&amp;rdquo;文本。&lt;/p&gt;
&lt;p&gt;3m表示3个月以内生成并删除的，而不3个月内删除的意思。&lt;/p&gt;
&lt;h4 id="3"&gt;3、&lt;a class="headerlink" href="#3" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h4&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;sudo ntfsundelete /dev/sda3 -d /home/wilson/tmp/ -u -i 881,2341,234,....
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;恢复inode为881,2341,234等的文件。&lt;/p&gt;
&lt;h4 id="5"&gt;5、&lt;a class="headerlink" href="#5" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h4&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;cd /home/wilson/tmp
chown wilson:wilson *
chmod a+r *
for fn in *.txt; do sed -i &amp;#39;s/\x00//g&amp;#39; $fn; done;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;恢复后文件属主为root，权限为600,&amp;nbsp;需修复。&lt;/p&gt;
&lt;p&gt;恢复后的文件一般末尾有多余的\x00，使用sed也可以替换，一开始没想到。&lt;/p&gt;
&lt;h4 id="6"&gt;6、&lt;a class="headerlink" href="#6" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h4&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;#done, enjoy it!
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;到恢复文件的位置去吧&lt;/p&gt;
&lt;h3 id="_2"&gt;参考&lt;a class="headerlink" href="#_2" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;［教学］在Ubuntu中恢复NTFS分区中被ubuntu误删除的文件（windows软件无法恢复的ubuntu中能恢复！
&lt;a href="http://forum.ubuntu.org.cn/viewtopic.php?t=158497"&gt;http://forum.ubuntu.org.cn/viewtopic.php?t=158497&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Linux下恢复ntfs格式的盘上的误删文件
&lt;a href="http://nyc1991.blog.51cto.com/6424159/1216592"&gt;http://nyc1991.blog.51cto.com/6424159/1216592&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Linux文件误删除恢复操作
&lt;a href="http://jingyan.baidu.com/article/2f9b480d6c2bcd41cb6cc223.html"&gt;http://jingyan.baidu.com/article/2f9b480d6c2bcd41cb6cc223.html&lt;/a&gt;&lt;/p&gt;</content><category term="实习"></category><category term="linux"></category><category term="ntfs"></category><category term="文件恢复"></category></entry></feed>