<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom"><title>Linux迷+Python粉 - 搬瓦工</title><link href="https://pythonwood.github.io/" rel="alternate"></link><link href="https://pythonwood.github.io/tag/ban-wa-gong/feed/atom/index.html" rel="self"></link><id>https://pythonwood.github.io/</id><updated>2018-11-25T20:00:00+08:00</updated><entry><title>网络检测ping脚本——搬瓦工CN2机房PING测试</title><link href="https://pythonwood.github.io/2018/11/%E7%BD%91%E7%BB%9C%E6%A3%80%E6%B5%8Bping%E8%84%9A%E6%9C%AC%E2%80%94%E2%80%94%E6%90%AC%E7%93%A6%E5%B7%A5CN2%E6%9C%BA%E6%88%BFPING%E6%B5%8B%E8%AF%95/" rel="alternate"></link><published>2018-11-25T20:00:00+08:00</published><updated>2018-11-25T20:00:00+08:00</updated><author><name>pythonwood</name></author><id>tag:pythonwood.github.io,2018-11-25:/2018/11/网络检测ping脚本——搬瓦工CN2机房PING测试/</id><summary type="html">&lt;h2 id="vps"&gt;项目起源：搬瓦工vps快过期&lt;a class="headerlink" href="#vps" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;为决定是否upgrade到cn2机房，需要先验证&lt;span class="caps"&gt;CN2&lt;/span&gt;机房网络是不是更好。一直没有一个适合自己的ping工具，自己写一个。&lt;/p&gt;
&lt;h3 id="openwrt5ping"&gt;部署在openwrt路由，定时任务每5分钟启动ping一次&lt;a class="headerlink" href="#openwrt5ping" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;脚本兼容新旧版本ping（输出内容不同），使用sh标准达到最大linux兼容。已兼容openwrt。&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;*/5 * * * * /path/to/20181119_host_ping.sh 23 …&lt;/pre&gt;&lt;/div&gt;</summary><content type="html">&lt;h2 id="vps"&gt;项目起源：搬瓦工vps快过期&lt;a class="headerlink" href="#vps" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;为决定是否upgrade到cn2机房，需要先验证&lt;span class="caps"&gt;CN2&lt;/span&gt;机房网络是不是更好。一直没有一个适合自己的ping工具，自己写一个。&lt;/p&gt;
&lt;h3 id="openwrt5ping"&gt;部署在openwrt路由，定时任务每5分钟启动ping一次&lt;a class="headerlink" href="#openwrt5ping" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;脚本兼容新旧版本ping（输出内容不同），使用sh标准达到最大linux兼容。已兼容openwrt。&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;*/5 * * * * /path/to/20181119_host_ping.sh 23.252.103.101 50 90 2 10  &amp;gt;&amp;gt;/tmp/ping.DC3.txt 2&amp;gt;/dev/null
*/5 * * * * /path/to/20181119_host_ping.sh 65.49.131.102  50 90 2 10  &amp;gt;&amp;gt;/tmp/ping.DC9.txt 2&amp;gt;/dev/null
*/5 * * * * /path/to/20181119_host_ping.sh myvps  50 90 2 10  &amp;gt;&amp;gt;/tmp/ping.myvps.txt 2&amp;gt;/dev/null
&lt;/pre&gt;&lt;/div&gt;


&lt;h2 id="host"&gt;最终版本的脚本，单host版&lt;a class="headerlink" href="#host" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h2&gt;
&lt;h3 id="_1"&gt;脚本使用与输出字段意义&lt;a class="headerlink" href="#_1" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h3&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;$ ./20181119_host_ping.sh
请参考文档使用：
./20181119_host_ping.sh &amp;lt;host&lt;span class="p"&gt;|&lt;/span&gt;&lt;span class="m"&gt;163&lt;/span&gt;.com&amp;gt; &amp;lt;pkgcn&lt;span class="p"&gt;|&lt;/span&gt;&lt;span class="m"&gt;10&lt;/span&gt;&amp;gt; &amp;lt;maxtime&lt;span class="p"&gt;|&lt;/span&gt;&lt;span class="m"&gt;30&lt;/span&gt;&amp;gt; &amp;lt;lost_step&lt;span class="p"&gt;|&lt;/span&gt;&lt;span class="m"&gt;2&lt;/span&gt;&amp;gt; &amp;lt;rt_step&lt;span class="p"&gt;|&lt;/span&gt;&lt;span class="m"&gt;5&lt;/span&gt;&amp;gt;

./20181119_host_ping.sh &lt;span class="m"&gt;163&lt;/span&gt;.com &lt;span class="m"&gt;10&lt;/span&gt; &lt;span class="m"&gt;30&lt;/span&gt; &lt;span class="m"&gt;1&lt;/span&gt; &lt;span class="m"&gt;5&lt;/span&gt; &lt;span class="o"&gt;(&lt;/span&gt;测10次ping，不超过30s，丢包率每字符表示1%，延迟每字符表示5ms&lt;span class="o"&gt;)&lt;/span&gt;
时间                出包 入包 丢包 min  avg  max &lt;span class="p"&gt;|&lt;/span&gt;图形化丢包率，最长25字符 &lt;span class="p"&gt;|&lt;/span&gt;图形化延迟avg，最多50字符
&lt;span class="m"&gt;2018&lt;/span&gt;-11-20_10:08:55    &lt;span class="m"&gt;3&lt;/span&gt;   &lt;span class="m"&gt;3&lt;/span&gt;   &lt;span class="m"&gt;2&lt;/span&gt;%  &lt;span class="m"&gt;166&lt;/span&gt;  &lt;span class="m"&gt;167&lt;/span&gt;  &lt;span class="m"&gt;169&lt;/span&gt; &lt;span class="p"&gt;|&lt;/span&gt;xx                       &lt;span class="p"&gt;|&lt;/span&gt;****************
&lt;/pre&gt;&lt;/div&gt;


&lt;h2 id="_2"&gt;比较结果&lt;a class="headerlink" href="#_2" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;搬瓦工&lt;span class="caps"&gt;CN2&lt;/span&gt; &lt;span class="caps"&gt;GIA&lt;/span&gt;质量非常稳定，土豪随意；对于移动用户访问，&lt;span class="caps"&gt;CN2&lt;/span&gt;比一般机房提升不大。&lt;/p&gt;
&lt;p&gt;一天之中2-10点网络最好，晚上6点至凌晨1点最差&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;root@Gargoyle:/tmp# tail ping.DC9.txt ping.DC3.txt ping.myvps.com.txt   -n 50
==&amp;gt; ping.DC9.txt &amp;lt;==
2018-11-25_16:00:01  50  50   0%  163  166  170 |                          |****************
2018-11-25_16:05:01  51  50   1%  163  177  301 |                          |*****************
2018-11-25_16:10:01  50  50   0%  162  166  170 |                          |****************
2018-11-25_16:15:01  50  50   0%  164  166  171 |                          |****************
2018-11-25_16:20:01  50  50   0%  164  166  169 |                          |****************
2018-11-25_16:25:01  50  50   0%  162  166  171 |                          |****************
2018-11-25_16:30:02  50  50   0%  164  166  171 |                          |****************
2018-11-25_16:35:01  50  50   0%  163  167  174 |                          |****************
2018-11-25_16:40:02  50  50   0%  164  167  172 |                          |****************
2018-11-25_16:45:01  50  50   0%  164  168  173 |                          |****************
2018-11-25_16:50:01  50  50   0%  163  166  171 |                          |****************
2018-11-25_16:55:01  50  50   0%  163  166  170 |                          |****************
2018-11-25_17:00:01  51  50   1%  163  166  174 |                          |****************
2018-11-25_17:05:01  50  50   0%  164  167  178 |                          |****************
2018-11-25_17:10:01  50  50   0%  163  166  171 |                          |****************
2018-11-25_17:15:01  50  50   0%  163  166  170 |                          |****************
2018-11-25_17:20:01  50  50   0%  163  166  169 |                          |****************
2018-11-25_17:25:01  50  50   0%  163  166  169 |                          |****************
2018-11-25_17:30:01  50  50   0%  163  166  171 |                          |****************
2018-11-25_17:35:01  50  50   0%  163  166  170 |                          |****************
2018-11-25_17:40:01  50  50   0%  164  167  172 |                          |****************
2018-11-25_17:45:01  50  50   0%  164  167  169 |                          |****************
2018-11-25_17:50:01  50  50   0%  164  166  169 |                          |****************
2018-11-25_17:55:01  50  50   0%  162  166  171 |                          |****************
2018-11-25_18:00:01  50  50   0%  164  166  170 |                          |****************
2018-11-25_18:05:01  50  50   0%  164  167  170 |                          |****************
2018-11-25_18:10:01  50  50   0%  163  165  168 |                          |****************
2018-11-25_18:15:01  50  50   0%  164  166  170 |                          |****************
2018-11-25_18:20:01  50  50   0%  164  166  170 |                          |****************
2018-11-25_18:25:01  50  50   0%  164  166  169 |                          |****************
2018-11-25_18:30:01  50  50   0%  164  166  169 |                          |****************
2018-11-25_18:35:01  50  50   0%  164  166  171 |                          |****************
2018-11-25_18:40:01  50  50   0%  164  167  171 |                          |****************
2018-11-25_18:45:01  50  50   0%  163  166  170 |                          |****************
2018-11-25_18:50:01  50  50   0%  164  166  171 |                          |****************
2018-11-25_18:55:01  50  50   0%  164  166  171 |                          |****************
2018-11-25_19:00:01  50  50   0%  164  167  188 |                          |****************
2018-11-25_19:05:01  50  50   0%  164  168  188 |                          |****************
2018-11-25_19:10:01  50  50   0%  163  166  171 |                          |****************
2018-11-25_19:15:01  50  50   0%  164  169  174 |                          |****************
2018-11-25_19:20:01  50  50   0%  163  168  183 |                          |****************
2018-11-25_19:25:01  50  50   0%  164  167  180 |                          |****************
2018-11-25_19:30:01  50  50   0%  164  168  187 |                          |****************
2018-11-25_19:35:01  50  50   0%  163  169  193 |                          |****************
2018-11-25_19:40:01  50  50   0%  162  168  196 |                          |****************
2018-11-25_19:45:01  50  50   0%  163  166  169 |                          |****************
2018-11-25_19:50:01  50  50   0%  163  167  169 |                          |****************
2018-11-25_19:55:01  50  50   0%  163  166  170 |                          |****************
2018-11-25_20:00:01  50  50   0%  163  167  192 |                          |****************
2018-11-25_20:05:01  50  50   0%  162  166  171 |                          |****************

==&amp;gt; ping.DC3.txt &amp;lt;==
2018-11-25_16:00:01  59  50  15%  234  283  333 |xxxxxxx                   |****************************
2018-11-25_16:05:01  56  50  10%  174  241  318 |xxxxx                     |************************
2018-11-25_16:10:01  52  50   3%  188  246  264 |x                         |************************
2018-11-25_16:15:01  51  50   1%  179  229  255 |                          |**********************
2018-11-25_16:20:02  50  50   0%  189  245  261 |                          |************************
2018-11-25_16:25:01  51  50   1%  188  246  267 |                          |************************
2018-11-25_16:30:02  52  50   3%  187  245  265 |x                         |************************
2018-11-25_16:35:02  50  50   0%  212  249  262 |                          |************************
2018-11-25_16:40:02  52  50   3%  181  249  264 |x                         |************************
2018-11-25_16:45:01  53  50   5%  191  233  261 |xx                        |***********************
2018-11-25_16:50:01  53  50   5%  188  249  263 |xx                        |************************
2018-11-25_16:55:01  50  50   0%  174  241  263 |                          |************************
2018-11-25_17:00:01  50  50   0%  208  248  263 |                          |************************
2018-11-25_17:05:01  50  50   0%  204  242  262 |                          |************************
2018-11-25_17:10:01  54  50   7%  188  216  252 |xxx                       |*********************
2018-11-25_17:15:01  51  50   1%  218  252  263 |                          |*************************
2018-11-25_17:20:01  51  50   1%  205  249  265 |                          |************************
2018-11-25_17:25:01  51  50   1%  196  243  261 |                          |************************
2018-11-25_17:30:01  52  50   3%  197  249  265 |x                         |************************
2018-11-25_17:35:01  52  50   3%  224  249  262 |x                         |************************
2018-11-25_17:40:01  54  50   7%  213  251  266 |xxx                       |*************************
2018-11-25_17:45:01  50  50   0%  221  247  265 |                          |************************
2018-11-25_17:50:01  52  50   3%  206  246  260 |x                         |************************
2018-11-25_17:55:01  53  50   5%  180  241  265 |xx                        |************************
2018-11-25_18:00:01  50  50   0%  207  243  262 |                          |************************
2018-11-25_18:05:01  52  50   3%  198  243  263 |x                         |************************
2018-11-25_18:10:01  52  50   3%  197  252  264 |x                         |*************************
2018-11-25_18:15:01  51  50   1%  220  247  263 |                          |************************
2018-11-25_18:20:01  51  50   1%  205  245  263 |                          |************************
2018-11-25_18:25:01  50  50   0%  178  221  247 |                          |**********************
2018-11-25_18:30:01  51  50   1%  178  237  262 |                          |***********************
2018-11-25_18:35:01  51  50   1%  161  187  261 |                          |******************
2018-11-25_18:40:01  51  50   1%  206  241  261 |                          |************************
2018-11-25_18:45:01  51  50   1%  165  188  209 |                          |******************
2018-11-25_18:50:01  50  50   0%  209  247  264 |                          |************************
2018-11-25_18:55:01  50  50   0%  196  236  261 |                          |***********************
2018-11-25_19:00:01  52  50   3%  167  200  222 |x                         |********************
2018-11-25_19:05:01  52  50   3%  170  200  238 |x                         |********************
2018-11-25_19:10:01  50  50   0%  225  248  263 |                          |************************
2018-11-25_19:15:01  51  50   1%  204  246  263 |                          |************************
2018-11-25_19:20:01  50  50   0%  226  248  263 |                          |************************
2018-11-25_19:25:01  51  50   1%  204  249  264 |                          |************************
2018-11-25_19:30:01  50  50   0%  212  253  265 |                          |*************************
2018-11-25_19:35:01  52  50   3%  206  245  265 |x                         |************************
2018-11-25_19:40:01  50  50   0%  206  241  286 |                          |************************
2018-11-25_19:45:01  50  50   0%  180  236  262 |                          |***********************
2018-11-25_19:50:01  50  50   0%  197  241  264 |                          |************************
2018-11-25_19:55:01  51  50   1%  213  255  265 |                          |*************************
2018-11-25_20:00:01  54  50   7%  204  254  264 |xxx                       |*************************
2018-11-25_20:05:01  53  50   5%  216  250  265 |xx                        |*************************

==&amp;gt; ping.myvps.txt &amp;lt;==
2018-11-25_16:00:01  67  50  25%  240  285  338 |xxxxxxxxxxxx              |****************************
2018-11-25_16:05:01  61  50  18%  183  247  325 |xxxxxxxxx                 |************************
2018-11-25_16:10:01  51  50   1%  219  254  270 |                          |*************************
2018-11-25_16:15:02  55  50   9%  182  236  262 |xxxx                      |***********************
2018-11-25_16:20:01  51  50   1%  197  258  524 |                          |*************************
2018-11-25_16:25:01  50  50   0%  193  276 1166 |                          |***************************
2018-11-25_16:30:02  52  50   3%  191  250  269 |x                         |*************************
2018-11-25_16:35:02  51  50   1%  231  256  270 |                          |*************************
2018-11-25_16:40:02  50  50   0%  190  254  269 |                          |*************************
2018-11-25_16:45:01  51  50   1%  194  239  266 |                          |***********************
2018-11-25_16:50:01  50  50   0%  191  256  270 |                          |*************************
2018-11-25_16:55:01  50  50   0%  179  247  266 |                          |************************
2018-11-25_17:00:01  51  50   1%  220  254  269 |                          |*************************
2018-11-25_17:05:01  50  50   0%  211  248  267 |                          |************************
2018-11-25_17:10:01  51  50   1%  194  222  256 |                          |**********************
2018-11-25_17:15:01  51  50   1%  213  258  271 |                          |*************************
2018-11-25_17:20:01  52  50   3%  209  255  268 |x                         |*************************
2018-11-25_17:25:01  50  50   0%  199  248  268 |                          |************************
2018-11-25_17:30:01  50  50   0%  198  255  270 |                          |*************************
2018-11-25_17:35:01  51  50   1%  231  255  270 |                          |*************************
2018-11-25_17:40:01  52  50   3%  220  257  270 |x                         |*************************
2018-11-25_17:45:01  51  50   1%  225  252  267 |                          |*************************
2018-11-25_17:50:01  50  50   0%  208  251  268 |                          |*************************
2018-11-25_17:55:01  51  50   1%  186  248  269 |                          |************************
2018-11-25_18:00:01  51  50   1%  211  248  272 |                          |************************
2018-11-25_18:05:01  52  50   3%  207  249  267 |x                         |************************
2018-11-25_18:10:01  52  50   3%  199  258  269 |x                         |*************************
2018-11-25_18:15:01  50  50   0%  223  252  269 |                          |*************************
2018-11-25_18:20:01  50  50   0%  210  250  267 |                          |*************************
2018-11-25_18:25:01  51  50   1%  184  227  254 |                          |**********************
2018-11-25_18:30:01  50  50   0%  187  244  267 |                          |************************
2018-11-25_18:35:01  51  50   1%  169  194  268 |                          |*******************
2018-11-25_18:40:01  51  50   1%  212  247  266 |                          |************************
2018-11-25_18:45:01  50  50   0%  170  193  213 |                          |*******************
2018-11-25_18:50:01  51  50   1%  216  252  269 |                          |*************************
2018-11-25_18:55:01  50  50   0%  201  242  267 |                          |************************
2018-11-25_19:00:01  50  50   0%  170  206  227 |                          |********************
2018-11-25_19:05:01  51  50   1%  175  208  261 |                          |********************
2018-11-25_19:10:01  50  50   0%  230  253  267 |                          |*************************
2018-11-25_19:15:01  53  50   5%  210  253  268 |xx                        |*************************
2018-11-25_19:20:01  50  50   0%  230  254  267 |                          |*************************
2018-11-25_19:25:01  50  50   0%  211  254  268 |                          |*************************
2018-11-25_19:30:01  50  50   0%  221  259  269 |                          |*************************
2018-11-25_19:35:01  51  50   1%  213  252  269 |                          |*************************
2018-11-25_19:40:01  50  50   0%  220  248  268 |                          |************************
2018-11-25_19:45:01  50  50   0%  187  241  267 |                          |************************
2018-11-25_19:50:01  50  50   0%  202  247  270 |                          |************************
2018-11-25_19:55:01  52  50   3%  216  261  268 |x                         |**************************
2018-11-25_20:00:01  51  50   1%  212  258  269 |                          |*************************
2018-11-25_20:05:01  52  50   3%  228  257  270 |x                         |*************************
&lt;/pre&gt;&lt;/div&gt;</content><category term="网络"></category><category term="ping"></category><category term="脚本"></category><category term="搬瓦工"></category></entry></feed>